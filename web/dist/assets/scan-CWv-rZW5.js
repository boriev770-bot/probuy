import"./modulepreload-polyfill-B5Qt9EMX.js";const P="modulepreload",I=function(E){return"/"+E},g={},L=function(e,d,u){let v=Promise.resolve();if(d&&d.length>0){document.getElementsByTagName("link");const o=document.querySelector("meta[property=csp-nonce]"),r=(o==null?void 0:o.nonce)||(o==null?void 0:o.getAttribute("nonce"));v=Promise.allSettled(d.map(i=>{if(i=I(i),i in g)return;g[i]=!0;const c=i.endsWith(".css"),f=c?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${i}"]${f}`))return;const a=document.createElement("link");if(a.rel=c?"stylesheet":P,c||(a.as="script"),a.crossOrigin="",a.href=i,r&&a.setAttribute("nonce",r),document.head.appendChild(a),c)return new Promise((l,w)=>{a.addEventListener("load",l),a.addEventListener("error",()=>w(new Error(`Unable to preload CSS for ${i}`)))})}))}function m(o){const r=new Event("vite:preloadError",{cancelable:!0});if(r.payload=o,window.dispatchEvent(r),!r.defaultPrevented)throw o}return v.then(o=>{for(const r of o||[])r.status==="rejected"&&m(r.reason);return e().catch(m)})};(async()=>{var b,S,B;const{BrowserMultiFormatReader:E}=await L(async()=>{const{BrowserMultiFormatReader:t}=await import("https://cdn.jsdelivr.net/npm/@zxing/browser@latest/+esm");return{BrowserMultiFormatReader:t}},[]),e=(b=window.Telegram)==null?void 0:b.WebApp;(S=e==null?void 0:e.ready)==null||S.call(e),(B=e==null?void 0:e.expand)==null||B.call(e);const d=document.getElementById("preview"),u=document.getElementById("manualInput"),v=document.getElementById("btnSend"),m=document.getElementById("btnStop"),o=document.getElementById("last"),r=document.getElementById("log");let i="";function c(t){i=t,o.textContent=t}function f(t,s){const n=document.createElement("div");n.className="chip "+(s?"ok":"err"),n.textContent=t,r.prepend(n)}const a=new E;let l=!0;await a.decodeFromVideoDevice(null,d,(t,s)=>{var n,y;if(l&&t){const p=(t.getText()||"").trim();p&&p!==i&&(c(p),u.value=p,(y=(n=e==null?void 0:e.HapticFeedback)==null?void 0:n.notificationOccurred)==null||y.call(n,"success"))}}),m.addEventListener("click",()=>{l=!l,m.textContent=l?"Пауза камеры":"Продолжить сканирование"});async function w(t,s,n){const y="",C={"X-Telegram-Init-Data":(e==null?void 0:e.initData)||new URLSearchParams(location.search).get("init_data")||"","Content-Type":"application/json"},k=await fetch(y+s,{method:t,headers:C,body:n?JSON.stringify(n):void 0});if(!k.ok)throw new Error((await k.json()).detail||"Request failed");return k.json()}async function h(t){const s=(u.value||"").trim().toUpperCase();if(!s){f("Введите код",!1);return}try{const n=await w("POST","/events/parcel-arrived",{tracking:s});f(`OK: ${s} (${n.notified||0})`,!0),c(s),u.value=""}catch(n){f(n.message||"Ошибка",!1)}}v.addEventListener("click",()=>h()),u.addEventListener("keydown",t=>{t.key==="Enter"&&(t.preventDefault(),h())}),e&&(e.MainButton.setParams({text:"Подтвердить прибытие"}),e.MainButton.onClick(()=>h()),e.MainButton.show())})();
